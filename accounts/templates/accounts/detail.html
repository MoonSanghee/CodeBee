{% extends "base_test.html" %}
{% load static %}
{% load django_bootstrap5 %}
{% block css %}
<link rel="stylesheet" href="{% static 'accounts/css/style.css' %}">
{% endblock css %}

{% block content %}
<div>
  <!-- 헤더 이미지 영역 -->
  <header class="row head p-5 shadow-lg">
    <div class="col-4">
      <div class="d-flex justify-content-center align-items-center h-100">
        <div>
          {% if person.profile_picture %}
          <img src="{{ person.profile_picture.url }}" alt="" class="rounded-circle border border-5">
          {% else %}
          <img src="https://dummyimage.com/180/000/fff" alt="" class="rounded-circle border border-5">
          {% endif %}
          <p class="fw-bold fs-4 text-center text-white mt-5">
            {{ person.nickname|default_if_none:" 어딘가의 드비" }}
          </p>
        </div>
      </div>
    </div>

    <!-- 이름, 이메일, 깃허브 -->
    <div class="text-white h-100 col-8 fs-4 d-flex flex-column justify-content-evenly">

      <p>
        {% if person.email %}
        {{ person.email }}
        {% else %}
        이메일이 존재하지 않습니다.
        {% endif %}
      </p>

      <table class="table" style="width:300px">
        <thead>
          <tr class="text-white">
            <th scope="col">스터디</th>
            <th scope="col">팔로잉</th>
            <th scope="col">팔로워</th>
          </tr>
        </thead>
        <tbody>
          <tr class="text-white text-center">
            <th scope="row">{{ std_cnt }}</th>
            <td>0</td>
            <td>0</td>
          </tr>
        </tbody>
      </table>
      <!-- 꿀단지 이미지 -->
      <div style="height:90px"></div>
      <div>
        <span class="icons" style="background: url('/static/accounts/image/honey.png') 0px 0px / 100px no-repeat;">
          <span class="icons2"
            style="padding-top: calc({{ honey }}*2px); background: url('/static/accounts/image/honey_fill.png') 0px calc({{ honey }}*2px - 100px) / 100px no-repeat;"></span>
        </span>
        {{honey}} 단지 <span class="d-inline-block" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
          data-bs-content="단지는 스터디 종료 후 다른 드비분들이 평가한 점수예요. 최고 점수는 35점이고, 최저는 0점이예요. 스터디에 참여해서 단지를 모아보세요.">
          <button style="width:40px; height:40px;" class="btn btn-secondary rounded-circle" type="button"
            disabled><span>i</span></button>
        </span>
      </div>
    </div>
  </header>
</div>

<div class="board">
  <div class="wrapper">
    <div class="tabs">
      <div class="tab">
        <input type="radio" name="css-tabs" id="tab-1" checked="checked" class="tab-switch">
        <label for="tab-1" class="tab-label">진행 중 스터디</label>
        <div class="tab-content">
          <!-- 진행중 스터디 -->
          <!-- 스터디 제목, 기간, 설명 -->
          <div class="row row-cols-1 row-cols-md-4 g-4">
            {% for ing in ings %}
            <div class="col">
              <a href="{% url 'reviews:detail' ing.study.pk %}">
                <div class="card border-0 shadow h-100">
                  {% if ing.study.image %}
                  <img src="{{ ing.study.image.url }}" class="card-img-top card-image" alt="...">
                  {% else %}
                  <div class="card-img-top h-100"></div>
                  {% endif %}
                  <div class="card-body"></div>
                  <h5 class="card-title study-title p-3">{{ ing.study.title }}</h5>
                  <div class="rounded-3 p-2 content-box">
                    <p class="study-content m-0">{{ ing.study.content }}</p>
                    <span class="border rounded-pill"><img src="{% static '/members.png' %}" alt="" class="members">{{
                      ing.study.accepted.all|length }}/{{ ing.study.limits }}</span>
                  </div>
                </div>
              </a>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- 참여한 스터디 -->
      <div class="tab">
        <input type="radio" name="css-tabs" id="tab-2" class="tab-switch">
        <label for="tab-2" class="tab-label">About{{ person.nickname|default_if_none:"어딘가의 드비" }}</label>
        <div class="tab-content">

          <!-- 제목 영역 -->
          <h2 class="detail-header">{{ person.nickname|default_if_none:"어딘가의 드비" }}
            님의 github 활동입니다</h2>
          <!-- 깃허브 영역 -->
          <div class="detail-content d-flex flex-column justify-content-center">
            <div style="text-align:center; font-size: larger;">
              {% if person.git_username %}
              <a href="https://github.com/{{ person.git_username }}/">
                <img
                  src="https://github-readme-stats.vercel.app/api/top-langs/?username={{ person.git_username }}&layout=compact">
              </a>
              {% else %}
              <div class="github-none">
                <img src="{% static '/accounts/image/github.png'%}" height="50px" alt="">
                <p>아직 연동된 깃허브가 없어요.</p>
              </div>
              {% if user == person %}
              <a href="{% url 'accounts:update' user.pk %}">지금 연동하러 가기</a>
              {% endif %}
              {% endif %}
            </div>
          </div>
          <!-- 제목 영역 -->
          <h2 class="detail-header">{{ person.nickname|default_if_none:"어딘가의 드비" }}
            님의 스터디 참여 내역입니다</h2>
          <!-- 내용 영역 -->
          <div class="detail-content d-flex flex-column justify-content-center">
            <div style="text-align:center; font-size: larger;">
              {% if accepts %}
              <p>{{ person.nickname|default_if_none:" 어딘가의 드비" }}님은
                {% for lang in langs %}
                <span class="{{ lang }}">{{ lang }}</span>
                {% endfor %}
                스터디를 가장 많이 참여하였습니다.
              </p>
              <p>{{ person.nickname|default_if_none:" 어딘가의 드비" }}
                님은 온라인<span class="study_count">{{ online|length }}</span>회, 오프라인<span class="study_count">{{
                  offline|length }}</span>회 스터디에 참여하였습니다.</p>
              {% else %}
              <p class="text-muted h-100">아직 참여한 스터디가 없습니다.</p>
              {% if user == person %}
              <a href="{% url 'reviews:index' %}">지금 참여하러 가기</a>
              {% endif %}
              {% endif %}
            </div>
          </div>
          <!-- 제목 영역 -->
          <h2 class="detail-header">{{ person.nickname|default_if_none:" 어딘가의 드비" }}
            님의 최근 리뷰 활동입니다</h2>
          <!-- 내용 영역 -->
          <div class="detail-content">
            {% comment %} 유저가 작성한 댓글이 하나라도 있다면, {% endcomment %}
            {% if person.comment_set.all %}
            <div class="p-3 d-flex">
              {% for comment in person.comment_set.all %}
              <div class="review_card">
                <div class="review_info">
                  {% if comment.study.image %}
                  <img src="{{ comment.study.image.url }}" alt="">
                  {% endif %}
                  <div class="info_wrapper">
                    <div class="review_title">{{ comment.study.title }}</div>
                    <div class="review_date">{{ comment.created_at }} 작성</div>
                  </div>

                </div>
                <div class="review_content">
                  {{ comment.content|truncatechars:44 }}
                </div>
              </div>
              {% endfor %}

              {% else %}
              <div class="detail-content d-flex flex-column justify-content-center">
                <div style="text-align:center; font-size: larger;">
                  <p>아직 작성된 리뷰가 없어요.</p>
                  <p>아래로 이동해 리뷰를 작성해보세요.</p>
                  {% if user == person %}
                  {% for study in uncomment_study %}
                  <div class="box-wrapper">
                    {% if study.image %}
                    <a class="none-review-box" href="{% url 'reviews:detail' study.pk %}"
                      style="background-image: url('{{ study.image.url }}')">
                      {% endif %}
                      <a class="none-review-box" href="{% url 'reviews:detail' study.pk %}"
                        style="background-image: url('{% static '/createb.png' %}')">
                        <p class="none-review-text">
                          {{ study.title }}
                        </p>
                      </a>
                      {% endfor %}
                      {% endif %}
                  </div>
                </div>
              </div>
              {% endif %}
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<script>
  const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
  const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))
</script>

{% endblock content %}