{% load django_bootstrap5 %}
{% load static %}

<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  {% block css %}{% endblock css %}
  {% bootstrap_css %}{% bootstrap_javascript %}
  <title>CodeBee</title>
  <link href="{% static 'css/menu.css' %}" rel="stylesheet" type="text/css" />
  <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square-neo.css" rel="stylesheet">
  <script src="https://kit.fontawesome.com/628c8d2499.js" crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simplebar@latest/dist/simplebar.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <style>
    body {
      font-family: 'NanumSquareNeo';
      overflow-x: hidden;
    }

    .simplebar-scrollbar::before {
      background-color: rgb(37, 37, 37);
    }

    .msgbox {
      position: absolute;
      top: 1rem;
      left: 1rem;
      width: 15rem;
      z-index: 2000;
    }
  </style>
</head>

<body>
  <img id="img1" style="position:absolute; left:0; top:0; z-index:10;" src="{% static  'm_logo.png' %} " width=" 50">

  <script>

    // 마우스 커서 위치 담을 변수
    var mouseX = 0;
    var mouseY = 0;

    function getMousePosition(e) {
      var eObj = window.event ? window.event : e; // IE, FF 에 따라 이벤트 처리 하기
      mouseX = eObj.clientX + 10;
      mouseY = eObj.clientY + document.documentElement.scrollTop + 10; // 화면을 스크롤 했을때를 위한 처리 (스크롤 한 만큼 마우스 Y좌표에 + )
      // documentElement 가 안된다면 body 바꿔야 한다. 크롬의 경우.. (자동파악 로직 필요)
    }

    function moveImg() {
      // 이미지 위치 파악하기
      var m_x = parseInt(document.getElementById('img1').style.left.replace('px', ''));
      var m_y = parseInt(document.getElementById('img1').style.top.replace('px', ''));

      // 이미지 움직이기
      document.getElementById('img1').style.left = Math.round(m_x + ((mouseX - m_x) / 3)) + 'px';
      document.getElementById('img1').style.top = Math.round(m_y + ((mouseY - m_y) / 3)) + 'px';

      // 부드럽게 따라오는 공식 대략..
      // 현재 이미지위치 = 현재이미지 위치 + (이미지 위치기준 마우스 커서 위치 / 적절한 나누기 값)
      // 반복 처리 해주면 됩니다.

      // ※ 이미지 위치 기준 마우스 커서 위치란?
      // 이미지를 기준으로 그 이미지에서 커서가 얼마나 떨어져 있는지 여부
    }

    document.onmousemove = getMousePosition; // 마우스가 움직이면 getMousePosition 함수 실행
    setInterval("moveImg()", 3); // moveImg 함수 반복 실행하여 이미지 움직이기

  </script>
  <div id="main-top">
    <!-- 높이를 정해주어야 스크롤이 고장나지 않음 -->
    <div class="msgbox p-0 m-0 animate__animated animate__fadeIn">
      {% if messages %}
      {% for message in messages %}
      <div class="toast show text-bg-{{ message.tags }} mb-3" aria-live="assertive" aria-atomic="true"
        style="position: relative; top: 2rem; left: 2rem;">
        <div class="toast-header">
          <strong class="me-auto">알림
          </strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
          {% if "이름" in message.message %}
          <p>{{ message }}</p>
          <div class="text-end">
            <a href="{% url 'accounts:detail' request.user.pk %}" class="btn btn-primary btn-sm">입력하러 가기</a>
          </div>
          {% else %}
          {{ message }}
          {% endif %}
        </div>
      </div>
      {% endfor %}
      {% endif %}
    </div>
    <!-- 네비게이션 -->
    <nav class="navbar navbar-expand-lg nav_bg" id="bg">
      <div class="container">
        <a href="{% url 'home' %}"><img src="{% static 'logo_yw.png' %}" width="60"></a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item ms-5">
              <a href="{% url 'reviews:index' %}">코드비 찾기</a>
            </li>
            <li class="nav-item">
              <a href="{% url 'reviews:create' %}">코드비 모으기</a>
            </li>
            <li class="nav-item">
              <a data-bs-toggle="offcanvas" href="#offcanvasRight" role="button" aria-controls="offcanvasRight">코드비
                정보</a>
            </li>
            <div id="indicator"></div>
          </ul>
        </div>
      </div>
    </nav>
    <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasRight"
      aria-labelledby="offcanvasRightLabel">
      <div class="offcanvas-header">
        <h5 id="offcanvasRightLabel">코드비 정보</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <hr style="color:white; border: solid 2px">
      <div class="offcanvas-body">
        {% if request.user.is_authenticated %}
        <p><a class="anc" href="{% url 'accounts:test' %}">내 정보</a></p>
        <h1>
          {{ request.user }}
          <a class="text-white" href="{% url 'accounts:logout' %}">로그아웃</a>
        </h1>
        {% else %}
        <h1>
          <a class="glow-on-hover" href="{% url 'accounts:login' %}" type="button">로그인</a>
        </h1>
        {% endif %}
      </div>
    </div>
  </div>
  <!-- 본문 영역 시작 -->
  <div id="main">
    {% block content %}
    {% endblock content %}
  </div>
  <!-- 본문 영역 끝 -->
  <footer id="main-footer" class="align-items-center no-gutters row"
    style="position:sticky; background:rgb(83, 83, 83); height: 80px; bottom: 0; z-index:3;">
    <div class="col-md-3"></div>
    <div class="col-12 col-md-6">
      <div class="justify-content-between no-gutters row">
        <div class="p-2 col-12">
          <p class="mb-0 text-white">@ Copyrights 2022 CodeBee All Rights Reserved</p>
        </div>
      </div>
    </div>
    <div class="col-4 col-md-3"></div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/simplebar@latest/dist/simplebar.min.js"></script>
  <script>
    const simpleBar = new SimpleBar(document.getElementById('main'));
    let main = document.getElementById("main");
    let topHeight = document.getElementById("main-top").clientHeight;
    let footerHeight = document.getElementById("main-footer").clientHeight;
    function setScreenSize() {
      let IntNowScreenHeight = window.innerHeight - topHeight - footerHeight; // 본문영역에 높이가 있는 div 추가되면 다시 계산하여 적용해야함
      // footer 가 fixed 처럼 움직임
      let StrNowScreenHeight = String(IntNowScreenHeight);
      main.style.height = StrNowScreenHeight + "px";
    };
    window.addEventListener("load", setScreenSize);
    window.addEventListener("resize", setScreenSize);
  </script>
  <script>
    const target = document.querySelector("body");
    const modal = document.querySelectorAll(".modal");
    let i = 0;
    for (i; i < modal.length; i++) {
      let modalBtn = document.querySelector(`#modal-btn${i}`);
      const modalDict = {}
      modalDict[`modal${i}`] = [modal[i], modalBtn];
      modalDict[`modal${i}`][1].addEventListener("click", function () {
        if (document.querySelector(".modal-backdrop") !== null) {
          const modalBack = document.querySelector("#modal-back-div");
          modalBack.appendChild(Object.values(modalDict)[0][0]);
        };
      });
    };
  </script>
  <div id="modal-back-div"></div>
</body>

</html>